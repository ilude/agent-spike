#!/usr/bin/env bash
# Post-checkout hook to prompt user to update Brave history

# Colors for output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Only run on branch checkouts (not file checkouts)
if [ "$3" = "1" ]; then
    echo ""
    echo -e "${YELLOW}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo -e "${YELLOW}  Brave History Sync${NC}"
    echo -e "${YELLOW}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo ""
    echo "Would you like to update the Brave history database?"
    echo "This will:"
    echo "  • Copy your current Brave history to data/brave_history.HOSTNAME.sqlite"
    echo "  • Consolidate all machine histories into data/brave_history.sqlite"
    echo "  • Deduplicate records across machines"
    echo ""
    read -p "Update Brave history? (y/N): " -n 1 -r
    echo ""
    
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo ""
        echo -e "${GREEN}Running Brave history update...${NC}"
        cd projects/brave_history
        python copy_brave_history.py
        
        if [ $? -eq 0 ]; then
            echo ""
            echo -e "${GREEN}✓ History updated successfully!${NC}"
            echo "  You can commit the updated brave_history.sqlite if desired:"
            echo "  ${YELLOW}git add projects/brave_history/data/brave_history.sqlite${NC}"
            echo "  ${YELLOW}git commit -m 'chore: update consolidated Brave history'${NC}"
        else
            echo -e "${YELLOW}⚠ Update failed. See errors above.${NC}"
        fi
        
        cd ../..
    else
        echo "Skipped. You can run this manually anytime:"
        echo "  ${YELLOW}cd projects/brave_history && python copy_brave_history.py${NC}"
    fi
    
    echo -e "${YELLOW}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo ""
fi
