#!/usr/bin/env bash
# Post-merge hook to automatically update Brave history after pull (no prompts)

# Colors for output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo ""
echo -e "${YELLOW}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo -e "${YELLOW}  Brave History Sync${NC}"
echo -e "${YELLOW}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo ""
echo -e "${YELLOW}Repository updated! Running Brave history update...${NC}"

# Run from repo root; switch into tool dir
(
    set -e
    cd projects/brave_history
    # Prefer uv if available to ensure the right environment
    if command -v uv >/dev/null 2>&1; then
        uv run python copy_brave_history.py
    else
        python copy_brave_history.py
    fi
)

if [ $? -eq 0 ]; then
    echo ""
    echo -e "${GREEN}✓ History updated successfully!${NC}"
    echo "  You can commit the updated consolidated database if desired:"
    echo -e "  ${YELLOW}git add projects/data/brave_history/brave_history.sqlite${NC}"
    echo -e "  ${YELLOW}git commit -m 'chore: update consolidated Brave history'${NC}"
else
    echo -e "${YELLOW}⚠ Update failed. See errors above.${NC}"
    echo -e "  ${YELLOW}Tip:${NC} try running manually:"
    echo -e "  ${YELLOW}cd projects/brave_history && python copy_brave_history.py${NC}"
fi

echo -e "${YELLOW}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo ""
