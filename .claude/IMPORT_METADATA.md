# Import Metadata & Recommendation Weighting

Documentation for tracking video import sources and recommendation signals.

## Overview

Every ingested video should track **how it was imported** to enable future recommendation weighting. Videos manually selected by the user are strong signals, while bulk channel imports are weaker signals.

## Metadata Schema

### Archive JSON Structure

Each archive file (`projects/data/archive/youtube/YYYY-MM/{video_id}.json`) should contain:

```json
{
  "video_id": "abc123",
  "url": "https://youtube.com/watch?v=abc123",
  "fetched_at": "2025-11-10T12:34:56",

  "import_metadata": {
    "source_type": "single_import",
    "imported_at": "2025-11-10T12:34:56",
    "import_method": "cli",
    "channel_context": {
      "channel_id": "UC...",
      "channel_name": "Example Channel",
      "is_bulk_import": false
    },
    "recommendation_weight": 1.0
  },

  "raw_transcript": "...",
  "youtube_metadata": {...},
  "llm_outputs": [...]
}
```

### Qdrant Metadata Structure

When caching in Qdrant, include import metadata in the point metadata:

```python
metadata = {
    "type": "youtube_video",
    "video_id": "abc123",
    "tags": "ai, automation, workflow",

    # Import tracking
    "source_type": "single_import",
    "recommendation_weight": 1.0,
    "imported_at": "2025-11-10T12:34:56",
    "is_bulk_import": False,
    "channel_id": "UC..."  # Optional
}
```

## Source Types

### `single_import` (weight: 1.0)
**Description**: User manually selected a single video via CLI
**Signal strength**: Highest - direct user choice
**Example**: `uv run python tools/scripts/ingest_video.py "https://youtube.com/..."`

**Characteristics**:
- Single URL provided by user
- Conscious selection decision
- Strong relevance signal

---

### `repl_import` (weight: 1.0)
**Description**: User manually added video via REPL interface
**Signal strength**: Highest - interactive user choice
**Example**: User types URL into `ingest_youtube.py` REPL prompt

**Characteristics**:
- Interactive selection
- Immediate user interest
- Same weight as `single_import` (both are manual selections)

---

### `bulk_channel` (weight: 0.5)
**Description**: Bulk import of all videos from a single channel
**Signal strength**: Medium - channel preference, not video-specific
**Example**: All videos from `fetch_channel_videos.py` output CSV

**Characteristics**:
- User likes the channel generally
- Not all videos equally relevant
- Some may be off-topic or outdated
- Moderate recommendation signal

**Detection**: CSV contains videos from only one `channel_id`

---

### `bulk_multi_channel` (weight: 0.2)
**Description**: Bulk import from multiple channels (AI bot scraped)
**Signal strength**: Lowest - algorithmic selection, not user choice
**Example**: CSV generated by AI scraper or recommendation bot

**Characteristics**:
- Not directly selected by user
- May contain noise or irrelevant content
- Exploratory/discovery mode
- Weak recommendation signal

**Detection**: CSV contains videos from multiple `channel_id` values

---

## Implementation Status

### Current State (as of 2025-11-10)

**Existing data**:
- 467 archived videos (no import metadata yet)
- 470 videos in Qdrant `cached_content` collection (no import metadata)

**Retroactive classification**:
Based on known ingestion history, existing videos can be classified:

1. **Videos from `nate_jones_videos_12mo.csv`**: `bulk_channel` (weight: 0.5)
2. **All other videos**: `single_import` (weight: 1.0)

### Implementation Tasks

**Phase 1: Update Services** ✅ Documented
- Add `import_metadata` parameter to `tools/services/archive.py::archive_youtube_video()`
- Update `tools/services/cache.py` to include import metadata in Qdrant points

**Phase 2: Update Ingestion Scripts**
- `tools/scripts/ingest_video.py`: Pass `source_type="single_import"`
- `tools/scripts/ingest_youtube.py`:
  - REPL mode: `source_type="repl_import"`
  - CSV batch: Detect single vs multi-channel → `bulk_channel` or `bulk_multi_channel`

**Phase 3: Retroactive Metadata**
- Create script to update existing 467 archives with import metadata
- Create script to update existing 470 Qdrant points with import metadata
- Use `nate_jones_videos_12mo.csv` to identify bulk channel imports

**Phase 4: Recommendation Engine** (Future)
- Use `recommendation_weight` in semantic search ranking
- Filter by `source_type` for curated recommendations
- Boost results from `single_import` / `repl_import` sources
- Downrank or exclude `bulk_multi_channel` in focused searches

---

## CSV Format Requirements

For bulk imports, CSVs should include channel information:

```csv
video_id,url,channel_id,channel_name,title
abc123,https://youtube.com/watch?v=abc123,UC...,Example Channel,Video Title
```

This enables automatic detection of single-channel vs multi-channel imports.

---

## Future Enhancements

### User Feedback Signals
Add explicit user actions as additional signals:

```json
"user_feedback": {
  "starred": false,
  "rating": null,  # 1-5 scale
  "watched": false,
  "shared": false,
  "notes": ""
}
```

### Time Decay
Adjust weights based on import age:

```python
# Newer imports may be more relevant
time_factor = calculate_time_decay(imported_at, current_time)
adjusted_weight = base_weight * time_factor
```

### Topic Relevance
Weight by topic/tag alignment with user's primary interests:

```python
# User's focus areas: ["ai-agents", "automation", "workflow"]
topic_match_score = calculate_topic_overlap(video_tags, user_interests)
final_weight = base_weight * topic_match_score
```

---

## References

- Archive service: `tools/services/archive.py`
- Cache service: `tools/services/cache.py`
- Single import: `tools/scripts/ingest_video.py`
- REPL import: `tools/scripts/ingest_youtube.py`
- Bulk import: CSVs in `projects/data/queues/completed/`

---

**Last updated**: 2025-11-10
**Status**: Schema designed, implementation pending
