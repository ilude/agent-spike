# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

**Terminology Note**: This is the **local/project ruleset** (specific to this repository). When references are made to "personal ruleset," that refers to the file in the user's home directory.

## Project Overview

**Multi-agent AI learning spike project** for hands-on exploration of building AI agents with Pydantic AI. This is a **learning/experimental repository**, NOT a production application.

**Primary focus**: Progressive lessons in `.spec/lessons/` teaching agent development patterns:
- **Lesson 001**: YouTube video tagging agent (YouTube Transcript API + Claude Haiku)
- **Lesson 002**: Webpage content tagging agent (Docling + Claude Haiku)
- **Lesson 003**: Multi-agent coordinator/router (pattern-based URL routing)

**Learning source**: Based on Cole Medin's "Learn 90% of Building AI Agents in 30 Minutes" video (https://www.youtube.com/watch?v=i5kwX7jeWL8).

**Tech stack**:
- Python 3.14
- Pydantic AI framework
- uv package manager (not pip)
- Typer CLIs per lesson
- Claude Haiku for cost-effective prototyping

**Development workflow**:
- Work directly in `.spec/lessons/` directories
- Run code with `uv run python` (handles virtual environments automatically)
- Each lesson is self-contained with its own agent, CLI, tests, and documentation

**Directory structure**:
```
.spec/                  # "Specification" - learning materials and experiments
‚îú‚îÄ‚îÄ lessons/           # Progressive agent-building lessons
‚îÇ   ‚îú‚îÄ‚îÄ lesson-001/    # YouTube tagging agent
‚îÇ   ‚îú‚îÄ‚îÄ lesson-002/    # Webpage tagging agent
‚îÇ   ‚îú‚îÄ‚îÄ lesson-003/    # Multi-agent coordinator
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ STATUS.md          # Current progress, known issues, resume instructions
src/                   # (Future) Production code would go here (currently empty)
```

## Quick Start

### First Time in This Codebase?

1. **Check current state**: `cat .spec/STATUS.md` - Shows completed lessons, current phase, known issues
2. **Verify lesson structure**: `ls .spec/lessons/` - See which lessons exist
3. **Install all dependencies**: `uv sync --all-groups`
4. **Set up API keys**: Each lesson needs `.env` file with `ANTHROPIC_API_KEY` and/or `OPENAI_API_KEY`
   ```bash
   # Copy from existing lesson or create new
   cd .spec/lessons/lesson-003
   cp ../lesson-001/.env .
   ```

### Resuming Work?

1. **Check git status**: `git status` - See what's uncommitted
2. **Read STATUS.md**: `.spec/STATUS.md` - Latest progress and next steps
3. **Sync dependencies**: `uv sync --group lesson-XXX` - For specific lesson
4. **Run existing tests**: Verify environment is working
   ```bash
   cd .spec/lessons/lesson-003
   uv run python test_router.py
   ```

### Working on Lessons?

- **Always use `uv run python`** to execute scripts (not `python` directly)
- Each lesson is in `.spec/lessons/lesson-XXX/`
- See "Multi-Agent Learning Lessons" section below for detailed patterns

## Multi-Agent Learning Lessons

### Relationship with STATUS.md

**IMPORTANT**: This CLAUDE.md file provides **static patterns and architectural guidance**.
For **dynamic state, current progress, and next steps**, always check `.spec/STATUS.md` first.

- **CLAUDE.md** (this file): How lessons are structured, best practices, commands
- **STATUS.md**: Which lessons are complete, current phase, known issues, resume instructions

### Lessons Structure

Each lesson is a self-contained module in `.spec/lessons/lesson-XXX/`:

```
lesson-XXX/
‚îú‚îÄ‚îÄ <name>_agent/          # Agent implementation package
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ agent.py           # Pydantic AI agent setup
‚îÇ   ‚îú‚îÄ‚îÄ tools.py           # Tool implementations
‚îÇ   ‚îú‚îÄ‚îÄ prompts.py         # System prompts
‚îÇ   ‚îî‚îÄ‚îÄ cli.py             # Typer CLI (optional)
‚îú‚îÄ‚îÄ .env                   # API keys (gitignored, never commit!)
‚îú‚îÄ‚îÄ PLAN.md                # Lesson plan and learning objectives
‚îú‚îÄ‚îÄ README.md              # Quick reference for the lesson
‚îú‚îÄ‚îÄ COMPLETE.md            # Summary of learnings after completion
‚îî‚îÄ‚îÄ test_*.py              # Test scripts and demos
```

**See `.spec/lessons/lesson-001/` or any existing lesson for concrete examples.**

### Dependency Management

**Important**: `pyproject.toml` has a **dual structure** due to migration:

1. **`[project.optional-dependencies]`** (lines 39-45): Legacy format with older versions
   ```toml
   lesson-001 = ["pydantic-ai>=0.0.14", ...]
   ```

2. **`[dependency-groups]`** (lines 67-81): Modern uv format with current versions ‚úÖ
   ```toml
   lesson-001 = ["pydantic-ai>=1.9.1", ...]
   ```

**Which to use?** Always use **`[dependency-groups]`** - these have the up-to-date versions and proper uv syntax.

**Install lesson dependencies:**
```bash
# Single lesson
uv sync --group lesson-001

# Multiple lessons
uv sync --group lesson-001 --group lesson-002

# All lessons (recommended)
uv sync --all-groups
```

**Dependency group composition:**
- `lesson-001`: YouTube agent deps (pydantic-ai, youtube-transcript-api, rich, etc.)
- `lesson-002`: Webpage agent deps (docling, plus all of lesson-001)
- `lesson-003`: Coordinator deps (includes both lesson-001 and lesson-002 via `{include-group = "..."}`)

### Virtual Environment Setup

**Hybrid .venv structure discovered during development:**

- **Lesson 001**: Has its own `.venv` directory (`.spec/lessons/lesson-001/.venv/`) - legacy from initial setup
- **Lessons 002, 003**: Use shared root `.venv` at project root
- **Root .venv**: Contains all dependencies from all lessons (created by `uv sync --all-groups`)

**The good news**: You don't need to manage this manually!

**Always use `uv run python`** and it handles virtual environment detection automatically:
```bash
cd .spec/lessons/lesson-003
uv run python test_router.py     # uv finds the right venv automatically
uv run python demo.py "URL"
```

**Why `uv run` is critical:**
- Automatically finds project root and correct `.venv`
- Works from any directory (root or subdirectories)
- Cross-platform (Windows/Linux/Mac)
- No manual venv activation needed
- No manual path management

**Don't do this:**
```bash
# ‚ùå Manual venv paths (brittle, platform-specific)
../../../.venv/Scripts/python.exe test_router.py

# ‚ùå System python (might not have dependencies)
python test_router.py

# ‚úÖ Always use uv run
uv run python test_router.py
```

### Running Lesson Code

**Standard patterns for running lesson code:**

```bash
# Navigate to lesson directory
cd .spec/lessons/lesson-XXX

# Run test scripts
uv run python test_router.py
uv run python test_coordinator.py

# Run demo scripts
uv run python demo.py "https://example.com"

# Run module CLI (if lesson has one)
uv run python -m <name>_agent.cli analyze "URL"
uv run python -m <name>_agent.cli interactive

# Run from project root (uv finds lesson venv)
uv run python .spec/lessons/lesson-003/demo.py "URL"
```

**Why this works from any directory:**
1. `uv` searches upward for `pyproject.toml` (finds project root)
2. Looks for `.venv` at project root
3. Also checks for lesson-specific `.venv` if in lesson directory
4. Runs command with correct Python interpreter and dependencies

### API Keys and Environment Variables

Lessons require API keys in `.env` files (per-lesson, not committed to git):

```bash
# Option 1: Copy from existing lesson
cd .spec/lessons/lesson-003
cp ../lesson-001/.env .

# Option 2: Create new .env file
cat > .env << 'EOF'
ANTHROPIC_API_KEY=sk-ant-...
OPENAI_API_KEY=sk-proj-...
DEFAULT_MODEL=claude-3-5-haiku-20241022
EOF
```

**Security**: `.env` files are gitignored. Never commit API keys!

**Model selection**: Lessons default to Claude Haiku (cheap, fast for prototyping). Override via `DEFAULT_MODEL` in `.env` or `--model` CLI flag.

### Best Practices for Lesson Work

1. ‚úÖ **Always use `uv run python`** for execution (not `python` or manual venv paths)
2. ‚úÖ **Read STATUS.md first** when resuming work
3. ‚úÖ **Update STATUS.md** after completing a lesson
4. ‚úÖ **Install dependencies before running** - `uv sync --group lesson-XXX`
5. ‚úÖ **Copy API keys** from existing lessons or create new `.env`
6. ‚úÖ **Run tests first** to verify environment setup
7. ‚úÖ **Don't reference `.venv` manually** - let uv handle it
8. ‚úÖ **Keep lessons self-contained** - avoid cross-lesson imports (except for lesson-003 coordinator pattern)

## Common Development Commands

### Most Common (Lesson Work)

```bash
# Run any Python script in lesson context
uv run python <script>.py

# Install dependencies for specific lesson
uv sync --group lesson-001
uv sync --all-groups              # Install all lessons

# Check what's installed
uv pip list

# Run lesson CLI (if available)
cd .spec/lessons/lesson-001
uv run python -m youtube_agent.cli analyze "https://youtube.com/..."
```

### Code Quality (Less Common)

```bash
# Format code
make format                       # black + isort

# Lint code
make lint                         # ruff

# Run tests
make test                         # pytest
```

### Container Builds (Rarely Needed for Lessons)

**Note**: Lessons run directly via `uv run python`. Container builds are for the (future) production app in `src/`.

```bash
# Build devcontainer (if needed)
make build-dev

# Build production image (not used for lessons)
make build
```

For full command reference, see `.devcontainer/Makefile` and root `Makefile`.

## Python Configuration

Code quality standards (applies if writing production code in `src/`):

- **Line length**: 88 characters (black standard)
- **Target version**: Python 3.14
- **Type checking**: mypy with strict mode enabled
- **Linting**: ruff with E, F, W, I, UP rules
- **Import sorting**: isort with black profile

**For lesson code**: These are guidelines, not strict requirements. Focus on learning!

## Background: Infrastructure & Architecture

**NOTE**: This section documents the containerized development setup. Most lesson work doesn't require understanding this - focus on the "Multi-Agent Learning Lessons" section above.

This infrastructure exists for potential future production deployment, not for daily lesson development.

### Package Management

- **Tool**: uv (modern Python package manager, 10-100x faster than pip)
- **Dependencies**: Defined in `pyproject.toml`
- **Lock file**: `uv.lock`
- **Why uv?**: Speed, better dependency resolution, built-in virtual env management

### Container Architecture (Background Info)

Multi-stage Dockerfile with four stages:

1. **base**: Python 3.14 slim with uv installed, user setup, entrypoint script
2. **build-base**: Adds build tools (gcc, cmake, git, etc.)
3. **production**: Minimal runtime with only necessary dependencies
4. **devcontainer**: Full development environment with tools (zsh, ripgrep, gh, docker, etc.)

**For lesson work**: You don't need to build or use these containers. Work directly on your host machine with `uv run python`.

### Makefile System

Two-level Makefile structure:
- **Root `Makefile`**: Container builds, version management, deployment
- **`.devcontainer/Makefile`**: Development tasks (lint, test, format, clean)

The root Makefile includes `.devcontainer/Makefile`, so all dev commands are available from the root.

### Environment Variables (Container Context)

- Cross-platform OS detection (linux/macos/windows)
- Container runtime auto-detection (docker/podman)
- Host IP detection for networking
- Semantic versioning from git tags

**For lesson work**: The only environment variables you need are API keys in `.env` files.

### CLI Entry Point (Future Production App)

The `src/app/cli.py` would be the main CLI entry point for a production version, registered as `agent-spike` command via `project.scripts` in pyproject.toml.

**Current state**: `src/` directory is empty. All working code is in `.spec/lessons/`.

---

## Summary for New Claude Sessions

1. **This is a learning project** - Multi-agent AI spike, not production app
2. **Work in `.spec/lessons/`** - Each lesson is self-contained
3. **Check STATUS.md first** - Current state and progress
4. **Use `uv run python`** - Handles virtual environments automatically
5. **Install deps with `uv sync --all-groups`** - Before running anything
6. **Copy `.env` from lesson-001** - API keys needed for each lesson
7. **Container/Docker stuff?** - Background info, not needed for lessons
8. **Questions?** - Read the lesson's README.md and COMPLETE.md

Happy learning! üöÄ
